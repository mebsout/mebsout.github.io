<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Frontend Certificates for Kind 2</title>
<!-- 2015-04-14 Tue 18:53 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Alain Mebsout" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<style type="text/css"> body{max-width:800px; margin:auto;padding:2em; font-size:1.1em; font-family:sans-serif; line-height:1.5; } code, pre{font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:85%} code{padding: 2px 4px;color: #c7254e; background-color: #f9f2f4; border-radius: 4px;} pre {word-break:break-word; background-color: #f8f8f8; border: 1px solid #ddd; border-radius: 4px; box-shadow:none; margin:0} pre.src {padding:10px 15px} a { color: #4183c4; text-decoration: none; } a:hover { text-decoration: underline; } h2 {border-bottom: 1px solid #eee;} table {border-width:2px 2px; border-color:#ddd} tbody>tr:nth-child(odd) {background-color: #f8f8f8;} blockquote {padding: 0 15px;  color: #555; border-left: 4px solid #ddd;} </style>
<script type="text/javascript" src="http://orgmode.org/org-info.js">
/**
 *
 * @source: http://orgmode.org/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in http://orgmode.org/org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in http://orgmode.org/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "0");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "#f5f5f5");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "showall");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Frontend Certificates for Kind 2</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Translation phases in Kind 2</a></li>
<li><a href="#sec-2">2. Frontend Certificates</a>
<ul>
<li><a href="#sec-2-1">2.1. Generation of Frontend Certificate</a></li>
<li><a href="#sec-2-2">2.2. Verification of Frontend Certificates</a></li>
<li><a href="#sec-2-3">2.3. Easier Frontend Certificates</a></li>
<li><a href="#sec-2-4">2.4. Example</a></li>
<li><a href="#sec-2-5">2.5. Conclusion</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Benchmarks</a>
<ul>
<li><a href="#sec-3-1">3.1. Rockwell Collins Benchmarks</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Translation phases in Kind 2</h2>
<div class="outline-text-2" id="text-1">
<p>
The input program and its properties are expressed in the synchronous language
Lustre. However, the certificate we produce considers the program expressed in
first order logic. In Kind 2, the Lustre file is first parsed and a number of
optimizations and simplifications (slicing, propagation, <i>etc.</i>) are performed
on this input. Only after is it translated to an internal representation which
is essentially a transition relation in First Order Logic (FOL).
</p>

<p>
The certification process needs to argue that these optimizations and
translations are correct. This can be done by proving once that this translator
is correct. For instance, in Coq, this would require to formalize the semantic
of Lustre and to show that it is preserved by all simplifications and
translations. However, we want to certify the actual program Kind 2. With Coq
we could extract some purely functional code to replace the current frontend of
Kind 2. This will likely yield not very efficient code, but more importantly it
would turn maintaining and improving this frontend into a convoluted process.
</p>

<p>
Another possibility, which we explore here, is to have this translation phase
generate certificates of its own. We describe the kind and format of these
certificates in the following. We also evaluate their applicability on a set of
benchmarks.
</p>
</div>
</div>



<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Frontend Certificates</h2>
<div class="outline-text-2" id="text-2">
<p>
Our certification process for the frontend part of Kind 2 is a lightweight one
and is constructed with the objective of keeping the whole chain entirely
<b>automatic</b>.
</p>

<p>
Instead of proving semantics preservation between the Lustre input and the
internal FOL representation of the transition relation, we prove the
<b>observational equivalence</b> of two internal representations <i>independently</i>
obtained from the same Lustre input.
</p>

<p>
To augment our confidence, we don't use two different frontend of Kind 2 but
instead rely on a completely different tool<sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>: <a href="https://github.com/agacek/jkind">jKind</a>.
</p>

<p>
jKind is another SMT based model checker for Lustre systems. As such it parses
Lustre files and transforms the given program in a transition relation. jKind
is a good candidate because it is sufficiently different from Kind 2. In
particular it is written in a different language (Java vs OCaml), does not
reuse any code from Kind 2 and is developed independently by different people
at Rockwell Collins (mainly <a href="http://loonwerks.com/people/andrew-gacek.html">Andrew Gacek</a>).
</p>

<p>
If our certificate is proven valid, then we can conclude that the transition
relations constructed by Kind 2 and jKind are <b>observationally equivalent</b>. In
our case this means that a set of streams identified as representing the state
(at each instant) are the same for both systems. One difficulty, as we will see
later on, is to identify this relevant set of variables.
</p>

<p>
Our idea for such certificates is for them to be a system which observes both
the Kind 2 system and the jKind system. The <i>observer</i> system feeds its two
subsystems the same inputs and ensure that the property of <i>observational
equivalence</i> is respected.
</p>

<p>
On the <a href="#fig:frontend">figure below</a>, we can see the internal systems generated for Kind 2 and
jKind.  The state variables are \(X_{1}\) partitioned between the input variables
(\(X_{1}^{in}\)) and the output variables (\(X_{1}^{out}\)). The formula describing the initial
states is \(I_{1}(X_{1})\) (over the variables \(X_{1}\)) and the transition relation is
represented by the formula \(T_{1}(X_{1}, X_{1}')\) that relates the values of the
variables before (\(X_{1}\)) and after (\(X_{1}'\)) execution of a step in the
system. Here the property is P<sub>1</sub> but we don't really care about it if we only
want to show the equivalence between the two systems. jKind's internal system
is represented by variables and formulas indexed by 2.
</p>
</div>



<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Generation of Frontend Certificate</h3>
<div class="outline-text-3" id="text-2-1">
<p>
In the following, we denote by \(\sim\) the equivalence relation we consider between
sets of variables. We do not define it precisely yet, but when both sets \(A =
\{ a_{1}, ..., a_{n} \}\) and \(B = \{ b_{1}, ..., b_{n} \}\) have the same cardinality and
when all \(a_{i}\) and \(b_{i}\) represent the same Lustre stream then \(A \sim B ~\equiv~ a_{1} =
b_{1} \ \land\ ... \ \land\ a_{n} = b_{n}\).
</p>

<p>
The system we create observes the values of variables of its two (Kind 2 and
jKind) subsystems. Its set of variables are the (disjoint) union of the
variables of the Kind 2 system (\(S_{1}\)) and the jKind system (\(S_{2}\)).
</p>

<p>
\[ X_{obs} = X_{1} \uplus X_{2} \]
</p>

<p>
The system in itself is \(S_{obs} = (I_{obs}, T_{obs})\) where the initial states are
those where \(S_{1}\) and \(S_{2}\) are in their initial states and they are fed the same
input values:
</p>

<p>
\[ I_{obs}(X_{obs}) = X_{1}^{in} \sim X_{2}^{in} \ \land\ I_{1}(X_{1}) \ \land\ I_{2}(X_{2}) \]
</p>

<p>
Similarly, the transition relation executes simultaneously a step of \(S_{1}\) and a
step of \(S_{2}\), feeding the same input variables (primed in this case):
</p>

<p>
\[ T_{obs}(X_{obs}, X_{obs}') = X_{1}^{in\prime} \sim X_{2}^{in\prime} \ \land\ T_{1}(X_{1}, X_{1}') \ \land\
T_{2}(X_{2}, X_{2}') \]
</p>

<p>
The property that this system must guarantee (if \(S_{1}\) and \(S_{2}\) are indeed
observationally equivalent) is that a defined subset of variables must take the
same values in every steps:
</p>

<p>
\[ P_{obs}(X_{obs}) = X_{1} \sim X_{2} \]
</p>

<p>
We call this system a <i>frontend certificate</i> (FEC), it is depicted on the right
of the <a href="#fig:frontend">following figure</a>.
</p>




<div id="fig:frontend" class="figure">
<p><a href="./frontend.png" width="100%"><img src="./frontend.png" alt="frontend.png" width="100%" /></a>
</p>
<p><span class="figure-number">Figure 1:</span> Generation and verification of frontend certificates</p>
</div>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Verification of Frontend Certificates</h3>
<div class="outline-text-3" id="text-2-2">
<p>
We can remark that this FEC is nothing more that a (reactive) system whose
property is a safety property. In fact this is exactly the kind of system that
can be analyzed by Kind 2. This is why we propose to use Kind 2<sup><a id="fnr.2" name="fnr.2" class="footref" href="#fn.2">2</a></sup> to verify its
own intermediate FEC.
</p>


<p>
The important aspect of our process is that the <i>observer</i> system is not
written in Lustre, but rather is expressed directly as a transition system
relating state variables and their primed values. The FEC produced by Kind 2 is
directly dumped in a format that is very close (with a one-to-one
correspondence) to the internal transition system. This allows us to bypass
completely Kind 2's frontend on the run of the FEC. To trust the FEC
verification, it is sufficient to use the traditional certificate generated by
Kind 2 (see Figure <a href="#fig:frontend">1</a>).
</p>

<p>
The certificate generated by this second run of Kind 2 is an SMT2 file that
guarantees the observational equivalence between the Kind 2 system and the
jKind system holds. We call this other certificate the Frontend certificate
certificate (FECC).
</p>
</div>
</div>


<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Easier Frontend Certificates</h3>
<div class="outline-text-3" id="text-2-3">
<p>
The observational equivalence will be proven if it is k-inductive or if PDR
manages to strengthen to an inductive invariant. This is not necessarily the
case if, for instance, the variables cannot be mapped back to their equivalents
in the other model checker. If an error is made then the equivalence might not
hold, but we should make sure that variables appearing in the properties can be
related.
</p>

<blockquote>
<p>
The naming in jKind is done after slicing, so variable names are not stable
modulo slicing. Ideally, we want to have model checkers name their variables in
a way that allows to uniquely identify the original Lustre source streams.
</p>

<p>
For example, something like
<code>node_call1$line-column$node_call2$line-column$.stream$instant?$.new_name</code>.
</p>
</blockquote>


<p>
The problem is that strict observational equivalence might be too strong of a
property in our case. In fact, to guarantee that <b>safety</b> properties are
equivalent in two systems then it is sufficient to show that they have the same
reachable sets. In reality, we only care about a <b>specific</b> safety property \(P\) of this
system, so it is in theory sufficient to show observational equivalence <i>only</i>
for this property. 
</p>

<p>
What we are interested in is the equivalence between the properties, <i>i.e.</i>
\(P_{1}(X_{1}) \Longleftrightarrow P_{2}(X_{2})\) should hold at every step. Moreover if \(P_{1}
= P_{2}\) then the subset of variables that appear in \(P\) should be observationally
equivalent.
</p>

<p>
This means that we extend our relation \(\sim\) to systems as
</p>
<div class="center">
<p>
\(S_{1} \sim S_{2}\) if and only if \(X_{1|P} \sim X_{2|P}\) is a safety property of \(S_{obs}\).
</p>
</div>

<p>
Of course now the chance that this new property be k-inductive in our new
system is highly improbable. What we propose here is to have, in addition, all
the observational equivalence relations between the other variables. Not as
real properties, but rather as aids for the model checker (<i>i.e.</i> as potential
invariants).
</p>
</div>
</div>


<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Example</h3>
<div class="outline-text-3" id="text-2-4">
<p>
The following <a href="./add_two.lus">Lustre model</a> adds two input variables together. The property of
interest claims that if both (real) inputs are greater than zero then the
result must be greater than zero.
</p>

<div class="org-src-container">

<pre class="src src-lustre"><span style="color: #8b2252;">node</span> <span style="color: #0000ff; font-weight: bold;">main</span> (a : <span style="color: #a0522d;">real</span>; b : <span style="color: #a0522d;">real</span>) <span style="color: #8b2252;">returns</span> (c : <span style="color: #a0522d;">real</span>);
<span style="color: #8b2252;">var</span>
   p1 : <span style="color: #a0522d;">bool</span>;
<span style="color: #8b2252;">let</span>
   c = a + b;
   p1 = ((a &gt; 0.0) <span style="color: #008b8b;">and</span> (b &gt; 0.0)) =&gt; (c &gt; 0.0);

   <span style="color: #b22222;">--%PROPERTY p1;</span>
<span style="color: #8b2252;">tel</span>;
</pre>
</div>


<p>
The FEC generated by Kind 2 is a file (here
<code>add_two.lus.frontend_certificate.kind2</code>) composed of three systems expressed
in the native input format of Kind 2. The first one is the original Kind 2
system.
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">------------------------------------------------------------------------</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Kind 2 system</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">------------------------------------------------------------------------</span>

(define-node main
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">State variables (with an extra scope 'jKind')</span>
  ((transSys.x_is_init_x Bool)
   (main.a Real <span style="color: #483d8b;">:input</span> <span style="color: #483d8b;">:for-inv-gen</span>)
   (main.b Real <span style="color: #483d8b;">:input</span> <span style="color: #483d8b;">:for-inv-gen</span>)
   (main.c Real <span style="color: #483d8b;">:for-inv-gen</span>)
   (main.p1 Bool <span style="color: #483d8b;">:for-inv-gen</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Initial states</span>
  (init
   (and
    transSys.x_is_init_x
    (= main.c (+ main.a main.b))
    (= main.p1 (=&gt; (and (&gt; main.a 0.0) (&gt; main.b 0.0)) (&gt; main.c 0.0)))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Transition relation</span>
  (trans
   (and
    (not (prime transSys.x_is_init_x))
    (= (prime main.c) (+ (prime main.a) (prime main.b)))
    (= (prime main.p1) (=&gt; (and (&gt; (prime main.a) 0.0) (&gt; (prime main.b) 0.0)) (&gt; (prime main.c) 0.0)))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Callers (the observer system OBS calls this node)</span>
  (callers
   (OBS
    ((transSys.x_is_init_x transSys.x_is_init_x)
     (main.a OBS.main.a)
     (main.b OBS.main.b)
     (main.c OBS.main.c)
     (main.p1 OBS.main.p1))
    (<span style="color: #a020f0;">lambda</span> ((X1 Bool)) (X1))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Original properties (will be ignored for subsystems)</span>
  (props ((p1 main.p1 <span style="color: #483d8b;">:user</span> <span style="color: #483d8b;">:8-5</span>)))

  )
</pre>
</div>

<p>
When launched on the file <code>add_two.lus</code>, jKind 2.1 (with a special set of
options) produces the following dump file.
</p>
<div class="org-src-container">

<pre class="src src-lisp">(set-option <span style="color: #483d8b;">:produce-models</span> true)
(define-fun T ((%init Bool) ($a$0 Real) ($b$0 Real) ($c$0 Real) ($p1$0 Bool) ($a$1 Real) ($b$1 Real) ($c$1 Real) ($p1$1 Bool)) Bool (and (= $c$1 (+ $a$1 $b$1)) (= $p1$1 (=&gt; (and (&gt; $a$1 (/ 0 10)) (&gt; $b$1 (/ 0 10))) (&gt; $c$1 (/ 0 10))))))
(declare-fun %init () Bool)
(declare-fun $a$~1 () Real)
(declare-fun $b$~1 () Real)
(declare-fun $c$~1 () Real)
(declare-fun $p1$~1 () Bool)
</pre>
</div>
<p>
from which we extract the transition relation constructed by jKind.
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">------------------------------------------------------------------------</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">jKind system</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">------------------------------------------------------------------------</span>

(define-node jKind
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">State variables (with an extra scope 'jKind')</span>
  ((jKind.$a$ Real <span style="color: #483d8b;">:for-inv-gen</span>)
   (jKind.$b$ Real <span style="color: #483d8b;">:for-inv-gen</span>)
   (jKind.$c$ Real <span style="color: #483d8b;">:for-inv-gen</span>)
   (jKind.$p1$ Bool <span style="color: #483d8b;">:for-inv-gen</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Initial states</span>
  (init
   (and
    (= jKind.$c$ (+ jKind.$a$ jKind.$b$))
    (= jKind.$p1$ (=&gt; (and (&gt; jKind.$a$ 0.0) (&gt; jKind.$b$ 0.0)) (&gt; jKind.$c$ 0.0)))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Transition relation</span>
  (trans
   (and
    (= (prime jKind.$c$) (+ (prime jKind.$a$) (prime jKind.$b$)))
    (= (prime jKind.$p1$) (=&gt; (and (&gt; (prime jKind.$a$) 0.0) (&gt; (prime jKind.$b$) 0.0)) (&gt; (prime jKind.$c$) 0.0)))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Callers (the observer system OBS calls this node)</span>
  (callers
   (OBS
    ((jKind.$a$ OBS.jKind.$a$)
     (jKind.$b$ OBS.jKind.$b$)
     (jKind.$c$ OBS.jKind.$c$)
     (jKind.$p1$ OBS.jKind.$p1$))
    (<span style="color: #a020f0;">lambda</span> ((X1 Bool)) (X1))))

  )
</pre>
</div>

<p>
Finally the FEC contains the observer system <code>OBS</code> constructed as described
above. Its property is to ensure observational equivalence between variables
that compose the original property. These properties start with the prefix
<code>PROPERTY_Observational_Equivalence</code> whereas equalities between other variables
are just here as an aid and start with the prefix
<code>OTHER_Observational_Equivalence</code>.
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">------------------------------------------------------------------------</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Observer system (top level system)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">------------------------------------------------------------------------</span>

(define-node OBS
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">State variables (with an extra scope 'OBS')</span>
  (
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">Kind2's state variables </span>
   (transSys.x_is_init_x Bool)
   (OBS.main.a Real <span style="color: #483d8b;">:input</span> <span style="color: #483d8b;">:for-inv-gen</span>)
   (OBS.main.b Real <span style="color: #483d8b;">:input</span> <span style="color: #483d8b;">:for-inv-gen</span>)
   (OBS.main.c Real <span style="color: #483d8b;">:for-inv-gen</span>)
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">jKind's state variables </span>
   (OBS.main.p1 Bool <span style="color: #483d8b;">:for-inv-gen</span>)
   (OBS.jKind.$a$ Real <span style="color: #483d8b;">:for-inv-gen</span>)
   (OBS.jKind.$b$ Real <span style="color: #483d8b;">:for-inv-gen</span>)
   (OBS.jKind.$c$ Real <span style="color: #483d8b;">:for-inv-gen</span>)
   (OBS.jKind.$p1$ Bool <span style="color: #483d8b;">:for-inv-gen</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Initial states</span>
  (init
   (and
    transSys.x_is_init_x
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">inputs are the same for Kind2 and jKind</span>
    (and (= OBS.main.a OBS.jKind.$a$) (= OBS.main.b OBS.jKind.$b$))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">initial states of Kind2 system</span>
    (__node_init_main transSys.x_is_init_x OBS.main.a OBS.main.b OBS.main.c OBS.main.p1)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">initial states of jKind system</span>
    (__node_init_jKind OBS.jKind.$a$ OBS.jKind.$b$ OBS.jKind.$c$ OBS.jKind.$p1$)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Transition relation</span>
  (trans
   (and
    (not (prime transSys.x_is_init_x))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">inputs are the same for Kind2 and jKind</span>
    (and (= (prime OBS.main.a) (prime OBS.jKind.$a$)) (= (prime OBS.main.b) (prime OBS.jKind.$b$)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">one step of Kind2 system</span>
    (__node_trans_main
     (prime transSys.x_is_init_x) (prime OBS.main.a) (prime OBS.main.b) (prime OBS.main.c) (prime OBS.main.p1)
     transSys.x_is_init_x OBS.main.a OBS.main.b OBS.main.c OBS.main.p1)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">one step of jKind system</span>
    (__node_trans_jKind
     (prime OBS.jKind.$a$) (prime OBS.jKind.$b$) (prime OBS.jKind.$c$) (prime OBS.jKind.$p1$)
     OBS.jKind.$a$ OBS.jKind.$b$ OBS.jKind.$c$ OBS.jKind.$p1$)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Properties to ensure observational equivalence</span>
  (props
   (
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">between variables of original properties</span>
    (PROPERTY_Observational_Equivalence_1 (= OBS.main.p1 OBS.jKind.$p1$) <span style="color: #483d8b;">:generated</span> ())
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">between other variables (as an aid)</span>
    (OTHER_Observational_Equivalence_2 (= OBS.main.a OBS.jKind.$a$) <span style="color: #483d8b;">:generated</span> ())
    (OTHER_Observational_Equivalence_3 (= OBS.main.b OBS.jKind.$b$) <span style="color: #483d8b;">:generated</span> ())
    (OTHER_Observational_Equivalence_4 (= OBS.main.c OBS.jKind.$c$) <span style="color: #483d8b;">:generated</span> ())))

  )
</pre>
</div>

<p>
The complete FEC is available <a href="./add_two.lus.frontend_certificate.kind2">here</a>.
</p>

<p>
Now we can verify this FEC and generate a FECC by issuing the command:
</p>
<div class="org-src-container">

<pre class="src src-sh">$ kind2 --certif --certif_min dicho add_two.lus.frontend_certificate.kind2
</pre>
</div>

<p>
We obtain an <a href="./add_two.lus.frontend_certificate.kind2.certificate.smt2">SMT2 certificate</a> (the FECC) for the properties of the FEC.
</p>
<div class="org-src-container">

<pre class="src src-sh">$ z3 add_two.lus.frontend_certificate.kind2.certificate.smt2
Checking base case
unsat
Checking 1-inductive case
unsat
Checking property subsumption
unsat
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> Conclusion</h3>
<div class="outline-text-3" id="text-2-5">
<p>
With the addition of the frontend certificates (FEC and FECC), we know have
three certificates when using the model checker Kind 2 in certifying mode
(option <code>--certif</code>). The FECC and and the SMT2 certificate for the original
property (P on figure <i>fig:chain</i>) can be verified by SMT solvers (whose output
can be also certified). A summary of our process is depicted in the
<i>following figure</i>.
</p>



<div class="figure">
<p><img src="process.png" alt="process.png" />
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Benchmarks</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Rockwell Collins Benchmarks</h3>
<div class="outline-text-3" id="text-3-1">
<p>
We give results on a set of benchmarks provided by Rockwell Collins. For each
one we report the following:
</p>
<dl class="org-dl">
<dt> Kind2 time </dt><dd>the time necessary for Kind 2 to prove (or disprove) all
properties
</dd>
<dt> FEC gen </dt><dd>the time that was used to generate the frontend certificate
</dd>
<dt> FEC size </dt><dd>the size of the FEC in term of the number of equivalence
relations to prove
</dd>
<dt> FEC MC </dt><dd>the time necessary for the second run of Kind 2 to prove the FEC
</dd>
<dt> FEC k </dt><dd>the k at which the properties of the FEC are k-inductive
</dd>
<dt> FECC gen </dt><dd>the time to generate the SMT2 frontend certificate certificate
</dd>
<dt> FECC k, size </dt><dd>both the k for the FECC and its size (elements in top level conjunction)
</dd>
<dt> Z3 check </dt><dd>the time taken by Z3 to check the certificate
</dd>
<dt> FECC check </dt><dd>the time taken by the SMT solver to check the final FECC
</dd>
</dl>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="left" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Bench</th>
<th scope="col" class="right">Kind2 time</th>
<th scope="col" class="right">FEC gen</th>
<th scope="col" class="right">FEC size</th>
<th scope="col" class="right">FEC MC</th>
<th scope="col" class="right">FEC k</th>
<th scope="col" class="right">FECC gen</th>
<th scope="col" class="left">FECC k, size</th>
<th scope="col" class="right">FECC check (z3)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">active-standby.kind.lus</td>
<td class="right">6.54</td>
<td class="right"><b>FAIL</b></td>
<td class="right">&#xa0;</td>
<td class="right">&#xa0;</td>
<td class="right">&#xa0;</td>
<td class="right">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">add_two.lus</td>
<td class="right">0.15</td>
<td class="right">0.74</td>
<td class="right">4</td>
<td class="right">0.18</td>
<td class="right">1</td>
<td class="right">0.02</td>
<td class="left">1, 4</td>
<td class="right">0.01</td>
</tr>

<tr>
<td class="left">bridge_and_torch.lus</td>
<td class="right">1.04</td>
<td class="right">0.80</td>
<td class="right">62</td>
<td class="right">0.24</td>
<td class="right">1</td>
<td class="right">0.12</td>
<td class="left">1, 62</td>
<td class="right">0.05</td>
</tr>

<tr>
<td class="left">dfa.lus</td>
<td class="right">0.16</td>
<td class="right">0.73</td>
<td class="right">4</td>
<td class="right">0.17</td>
<td class="right">1</td>
<td class="right">0.02</td>
<td class="left">1, 4</td>
<td class="right">0.01</td>
</tr>

<tr>
<td class="left">inv_gen.lus</td>
<td class="right">0.22</td>
<td class="right">0.72</td>
<td class="right">3</td>
<td class="right">0.16</td>
<td class="right">1</td>
<td class="right">0.02</td>
<td class="left">1, <b>4</b></td>
<td class="right">0.01</td>
</tr>

<tr>
<td class="left">microwave.kind.lus</td>
<td class="right">2.57</td>
<td class="right">1.07</td>
<td class="right">46</td>
<td class="right">35.7</td>
<td class="right"><b>6</b></td>
<td class="right">1.07</td>
<td class="left"><b>3</b>, <b>79</b></td>
<td class="right">0.81</td>
</tr>

<tr>
<td class="left">pid.lus</td>
<td class="right">8.81</td>
<td class="right">0.80</td>
<td class="right">15</td>
<td class="right">0.18</td>
<td class="right">1</td>
<td class="right">0.04</td>
<td class="left">1, 15</td>
<td class="right">0.02</td>
</tr>

<tr>
<td class="left">pilot_flying.lus</td>
<td class="right">19.83</td>
<td class="right">1.05</td>
<td class="right">107</td>
<td class="right">0.38</td>
<td class="right">1</td>
<td class="right">0.24</td>
<td class="left">1, 107</td>
<td class="right">0.12</td>
</tr>

<tr>
<td class="left">simple_counter.lus</td>
<td class="right">0.16</td>
<td class="right">0.73</td>
<td class="right">2</td>
<td class="right">0.16</td>
<td class="right">1</td>
<td class="right">0.02</td>
<td class="left">1, <b>4</b></td>
<td class="right">0.01</td>
</tr>

<tr>
<td class="left">triangle_peg_impossible.lus</td>
<td class="right">7.90</td>
<td class="right">1.08</td>
<td class="right">158</td>
<td class="right">1.53</td>
<td class="right">1</td>
<td class="right">0.42</td>
<td class="left">1, 158</td>
<td class="right">0.44</td>
</tr>
</tbody>
</table>

<p>
We remark that on all files, the FEC is <b>inductive</b> excepted for
<code>microwave.lus</code>. The time to generate the FEC, is essentially the time taken by
jKind to dump its first file plus the time to parse it back. On one of these
examples (<code>active_standby.lus</code>) jKind does out of memory so we were not able to
generate an FEC.
</p>

<p>
Also worth noting is that for three of them, invariants discovery was helpful
in speeding up the verification of the FEC (the ones for which the size of the
FECC is larger than the size of the FEC).
</p>

<p>
For the others, all observational equivalence properties have been verified and
certified (not only the ones that concern the equivalence property).
</p>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p>This idea is similar to what
is implemented in <a href="http://www.prover.com/products/prover_certifier/">Prover Certifier</a></p></div>

<div class="footdef"><sup><a id="fn.2" name="fn.2" class="footnum" href="#fnr.2">2</a></sup> <p>Note that
we could use another model checker to verify this FEC, provided it has the
adequate frontend to handle arbitrary FOL transition systems.</p></div>


</div>
</div></div>
</body>
</html>
